{"version":3,"file":"template-factory.js","sources":["../../../../js/src/util/template-factory.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap (v5.3.0-alpha1): util/template-factory.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport { DefaultAllowlist, sanitizeHtml } from './sanitizer.js'\nimport { execute, getElement, isElement } from './index.js'\nimport SelectorEngine from '../dom/selector-engine.js'\nimport Config from './config.js'\n\n/**\n * Constants\n */\n\nconst NAME = 'TemplateFactory'\n\nconst Default = {\n  allowList: DefaultAllowlist,\n  content: {}, // { selector : text ,  selector2 : text2 , }\n  extraClass: '',\n  html: false,\n  sanitize: true,\n  sanitizeFn: null,\n  template: '<div></div>'\n}\n\nconst DefaultType = {\n  allowList: 'object',\n  content: 'object',\n  extraClass: '(string|function)',\n  html: 'boolean',\n  sanitize: 'boolean',\n  sanitizeFn: '(null|function)',\n  template: 'string'\n}\n\nconst DefaultContentType = {\n  entry: '(string|element|function|null)',\n  selector: '(string|element)'\n}\n\n/**\n * Class definition\n */\n\nclass TemplateFactory extends Config {\n  constructor(config) {\n    super()\n    this._config = this._getConfig(config)\n  }\n\n  // Getters\n  static get Default() {\n    return Default\n  }\n\n  static get DefaultType() {\n    return DefaultType\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n  getContent() {\n    return Object.values(this._config.content)\n      .map(config => this._resolvePossibleFunction(config))\n      .filter(Boolean)\n  }\n\n  hasContent() {\n    return this.getContent().length > 0\n  }\n\n  changeContent(content) {\n    this._checkContent(content)\n    this._config.content = { ...this._config.content, ...content }\n    return this\n  }\n\n  toHtml() {\n    const templateWrapper = document.createElement('div')\n    templateWrapper.innerHTML = this._maybeSanitize(this._config.template)\n\n    for (const [selector, text] of Object.entries(this._config.content)) {\n      this._setContent(templateWrapper, text, selector)\n    }\n\n    const template = templateWrapper.children[0]\n    const extraClass = this._resolvePossibleFunction(this._config.extraClass)\n\n    if (extraClass) {\n      template.classList.add(...extraClass.split(' '))\n    }\n\n    return template\n  }\n\n  // Private\n  _typeCheckConfig(config) {\n    super._typeCheckConfig(config)\n    this._checkContent(config.content)\n  }\n\n  _checkContent(arg) {\n    for (const [selector, content] of Object.entries(arg)) {\n      super._typeCheckConfig({ selector, entry: content }, DefaultContentType)\n    }\n  }\n\n  _setContent(template, content, selector) {\n    const templateElement = SelectorEngine.findOne(selector, template)\n\n    if (!templateElement) {\n      return\n    }\n\n    content = this._resolvePossibleFunction(content)\n\n    if (!content) {\n      templateElement.remove()\n      return\n    }\n\n    if (isElement(content)) {\n      this._putElementInTemplate(getElement(content), templateElement)\n      return\n    }\n\n    if (this._config.html) {\n      templateElement.innerHTML = this._maybeSanitize(content)\n      return\n    }\n\n    templateElement.textContent = content\n  }\n\n  _maybeSanitize(arg) {\n    return this._config.sanitize ? sanitizeHtml(arg, this._config.allowList, this._config.sanitizeFn) : arg\n  }\n\n  _resolvePossibleFunction(arg) {\n    return execute(arg, [this])\n  }\n\n  _putElementInTemplate(element, templateElement) {\n    if (this._config.html) {\n      templateElement.innerHTML = ''\n      templateElement.append(element)\n      return\n    }\n\n    templateElement.textContent = element.textContent\n  }\n}\n\nexport default TemplateFactory\n"],"names":["NAME","Default","allowList","DefaultAllowlist","content","extraClass","html","sanitize","sanitizeFn","template","DefaultType","DefaultContentType","entry","selector","TemplateFactory","Config","constructor","config","_config","_getConfig","getContent","Object","values","map","_resolvePossibleFunction","filter","Boolean","hasContent","length","changeContent","_checkContent","toHtml","templateWrapper","document","createElement","innerHTML","_maybeSanitize","text","entries","_setContent","children","classList","add","split","_typeCheckConfig","arg","templateElement","SelectorEngine","findOne","remove","isElement","_putElementInTemplate","getElement","textContent","sanitizeHtml","execute","element","append"],"mappings":"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"}